<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Commerce - Smart Checkout</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #6366f1;
            --primary-dark: #4f46e5;
            --secondary: #f8fafc;
            --accent: #10b981;
            --text: #0f172a;
            --text-light: #64748b;
            --border: #e2e8f0;
            --success: #22c55e;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #0f0f23 0%, #1a1a2e 50%, #16213e 100%);
            min-height: 100vh;
            color: #e2e8f0;
            position: relative;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: 
                radial-gradient(circle at 20% 50%, rgba(120, 119, 198, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(255, 119, 198, 0.1) 0%, transparent 50%);
            z-index: -1;
        }

        .container { max-width: 1200px; margin: 0 auto; padding: 2rem; }

        .header {
            background: rgba(30, 41, 59, 0.8);
            backdrop-filter: blur(20px);
            border-radius: 24px;
            padding: 2rem;
            margin-bottom: 2rem;
            border: 1px solid rgba(148, 163, 184, 0.1);
            text-align: center;
        }

        .store-logo {
            font-size: 3rem;
            font-weight: 800;
            background: linear-gradient(135deg, #60a5fa, #c084fc, #fb7185);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 0.5rem;
        }

        .store-tagline {
            color: #94a3b8;
            font-size: 1.2rem;
        }

        .checkout-container {
            display: grid;
            grid-template-columns: 1fr 400px;
            gap: 2rem;
        }

        .checkout-form {
            background: rgba(30, 41, 59, 0.8);
            backdrop-filter: blur(20px);
            border-radius: 24px;
            padding: 2rem;
            border: 1px solid rgba(148, 163, 184, 0.1);
        }

        .section-title {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 1.5rem;
            color: #f1f5f9;
        }

        .form-group { margin-bottom: 1.5rem; }

        .form-label {
            display: block;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: #e2e8f0;
        }

        .form-input {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid rgba(148, 163, 184, 0.2);
            border-radius: 12px;
            font-size: 16px;
            transition: all 0.3s ease;
            background: rgba(15, 23, 42, 0.6);
            color: #e2e8f0;
        }

        .form-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }

        .order-summary {
            background: rgba(30, 41, 59, 0.8);
            backdrop-filter: blur(20px);
            border-radius: 24px;
            padding: 2rem;
            border: 1px solid rgba(148, 163, 184, 0.1);
            height: fit-content;
        }

        .product-item {
            display: flex;
            align-items: center;
            padding: 1rem 0;
            border-bottom: 1px solid rgba(148, 163, 184, 0.1);
        }

        .product-image {
            width: 60px; height: 80px;
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            border-radius: 8px;
            margin-right: 1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
        }

        .product-details { flex: 1; }

        .product-name {
            font-weight: 600;
            margin-bottom: 4px;
            color: #f1f5f9;
        }

        .product-author {
            font-size: 14px;
            color: #94a3b8;
        }

        .product-price {
            font-weight: 700;
            color: var(--primary);
        }

        .summary-row {
            display: flex;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid rgba(148, 163, 184, 0.1);
            color: #e2e8f0;
        }

        .summary-row:last-child {
            border-bottom: none;
            font-weight: 700;
            font-size: 1.2rem;
            color: var(--primary);
        }

        .pay-button {
            width: 100%;
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            border: none;
            padding: 16px;
            border-radius: 12px;
            font-size: 18px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 1.5rem;
        }

        .pay-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(99, 102, 241, 0.3);
        }

        .pay-button.processing {
            background: var(--text-light);
            cursor: not-allowed;
            transform: none;
        }

        .processing-spinner {
            display: none;
            width: 20px; height: 20px;
            border: 2px solid transparent;
            border-top: 2px solid white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 8px;
        }

        .pay-button.processing .processing-spinner { display: inline-block; }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .success-message {
            display: none;
            background: linear-gradient(135deg, var(--success), var(--accent));
            color: white;
            padding: 1rem;
            border-radius: 12px;
            margin-top: 1rem;
            text-align: center;
            font-weight: 600;
        }

        .bank-integration-notice {
            background: linear-gradient(135deg, rgba(245, 158, 11, 0.1), rgba(251, 191, 36, 0.1));
            border: 1px solid rgba(245, 158, 11, 0.3);
            border-radius: 12px;
            padding: 1rem;
            margin-bottom: 1.5rem;
            color: #fbbf24;
            font-size: 14px;
        }

        .demo-controls {
            background: rgba(30, 41, 59, 0.8);
            backdrop-filter: blur(20px);
            border-radius: 24px;
            padding: 2rem;
            margin-top: 2rem;
            border: 1px solid rgba(148, 163, 184, 0.1);
        }

        .demo-title {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 1rem;
            color: #f1f5f9;
        }

        .demo-description {
            color: #94a3b8;
            margin-bottom: 1.5rem;
            line-height: 1.6;
        }

        .merchant-selector {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .merchant-btn {
            padding: 1rem;
            border: 2px solid rgba(148, 163, 184, 0.2);
            border-radius: 12px;
            background: rgba(15, 23, 42, 0.6);
            color: #e2e8f0;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }

        .merchant-btn:hover, .merchant-btn.active {
            border-color: var(--accent);
            background: var(--accent);
            color: white;
            transform: translateY(-2px);
        }

        .merchant-icon { font-size: 2rem; margin-bottom: 0.5rem; }
        .merchant-name { font-weight: 600; margin-bottom: 0.25rem; }
        .merchant-category { font-size: 0.875rem; opacity: 0.8; }

        .amount-selector {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .amount-btn {
            padding: 1rem 1.5rem;
            border: 2px solid rgba(148, 163, 184, 0.2);
            border-radius: 12px;
            background: rgba(15, 23, 42, 0.6);
            color: #e2e8f0;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
        }

        .amount-btn:hover, .amount-btn.active {
            border-color: var(--primary);
            background: var(--primary);
            color: white;
            transform: translateY(-2px);
        }

        @media (max-width: 768px) {
            .checkout-container { grid-template-columns: 1fr; }
            .form-row { grid-template-columns: 1fr; }
            .container { padding: 1rem; }
            .amount-selector { grid-template-columns: 1fr 1fr; }
            .merchant-selector { grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1 class="store-logo" id="store-name">üìö Commerce</h1>
            <p class="store-tagline" id="store-tagline">Smart shopping with automatic charity roundups</p>
        </div>

        <div class="checkout-container">
            <div class="checkout-form">
                <h2 class="section-title">Checkout</h2>
                
                <div class="bank-integration-notice">
                    üè¶ <strong>Live Demo:</strong> Payment will be processed through Bank with real AI charity selection
                </div>

                <form id="checkout-form">
                    <div class="form-group">
                        <label class="form-label">Email Address</label>
                        <input type="email" class="form-input" value="student@university.ac.uk" required>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Full Name</label>
                        <input type="text" class="form-input" value="Alex Thompson" required>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Card Number</label>
                            <input type="text" class="form-input" value="**** **** **** 1234" readonly>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Expiry</label>
                            <input type="text" class="form-input" value="12/26" readonly>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Billing Address</label>
                        <input type="text" class="form-input" value="University Campus, London" required>
                    </div>
                </form>
            </div>

            <div class="order-summary">
                <h2 class="section-title">Order Summary</h2>

                <div id="cart-items">
                    <div class="product-item">
                        <div class="product-image" id="product-icon">üìñ</div>
                        <div class="product-details">
                            <div class="product-name" id="product-name">Advanced Mathematics Textbook</div>
                            <div class="product-author" id="product-author">by Dr. Smith</div>
                        </div>
                        <div class="product-price" id="product-price">¬£28.99</div>
                    </div>
                </div>

                <div style="margin-top: 1.5rem;">
                    <div class="summary-row">
                        <span>Subtotal:</span>
                        <span id="subtotal">¬£28.99</span>
                    </div>
                    <div class="summary-row">
                        <span>Shipping:</span>
                        <span>Free</span>
                    </div>
                    <div class="summary-row">
                        <span>Total:</span>
                        <span id="total">¬£28.99</span>
                    </div>
                </div>

                <button class="pay-button" onclick="processPayment()">
                    <span class="processing-spinner"></span>
                    <span class="button-text">Pay Now</span>
                </button>

                <div class="success-message" id="success-message">
                    ‚úÖ Payment successful! Check your Bank app for the transaction and charity donation.
                </div>
            </div>
        </div>

        <div class="demo-controls">
            <h3 class="demo-title">AI Demo Controls</h3>
            <p class="demo-description">
                Test different merchant types to see how our AI selects the most appropriate charity for each purchase. 
                Each merchant triggers different AI reasoning patterns.
            </p>
            
            <div>
                <label class="form-label">Select Merchant Type (AI will analyze this):</label>
                <div class="merchant-selector">
                    <div class="merchant-btn active" onclick="setMerchant('BookHub', 'bookstore')">
                        <div class="merchant-icon">üìö</div>
                        <div class="merchant-name">BookHub</div>
                        <div class="merchant-category">Education</div>
                    </div>
                    <div class="merchant-btn" onclick="setMerchant('Costa Coffee', 'cafe')">
                        <div class="merchant-icon">‚òï</div>
                        <div class="merchant-name">Costa Coffee</div>
                        <div class="merchant-category">Food & Drink</div>
                    </div>
                    <div class="merchant-btn" onclick="setMerchant('Tesco Express', 'grocery')">
                        <div class="merchant-icon">üõí</div>
                        <div class="merchant-name">Tesco</div>
                        <div class="merchant-category">Grocery</div>
                    </div>
                    <div class="merchant-btn" onclick="setMerchant('Uber', 'transport')">
                        <div class="merchant-icon">üöó</div>
                        <div class="merchant-name">Uber</div>
                        <div class="merchant-category">Transport</div>
                    </div>
                    <div class="merchant-btn" onclick="setMerchant('PureGym', 'fitness')">
                        <div class="merchant-icon">üí™</div>
                        <div class="merchant-name">PureGym</div>
                        <div class="merchant-category">Fitness</div>
                    </div>
                    <div class="merchant-btn" onclick="setMerchant('Boots Pharmacy', 'health')">
                        <div class="merchant-icon">üíä</div>
                        <div class="merchant-name">Boots</div>
                        <div class="merchant-category">Health</div>
                    </div>
                </div>
            </div>
            
            <div>
                <label class="form-label">Amount (affects roundup calculation):</label>
                <div class="amount-selector">
                    <button class="amount-btn" onclick="setAmount(4.67)">¬£4.67</button>
                    <button class="amount-btn" onclick="setAmount(15.43)">¬£15.43</button>
                    <button class="amount-btn active" onclick="setAmount(28.99)">¬£28.99</button>
                    <button class="amount-btn" onclick="setAmount(67.20)">¬£67.20</button>
                </div>
            </div>
            
            <div class="form-group">
                <label class="form-label">Custom Amount:</label>
                <input type="number" class="form-input" id="custom-amount" step="0.01" min="0.01" 
                       placeholder="Enter custom amount" onchange="setCustomAmount()">
            </div>
        </div>
    </div>

    <script>
        let currentAmount = 28.99;
        let currentMerchant = 'BookHub';
        let currentMerchantType = 'bookstore';

        const merchantData = {
            'BookHub': {
                name: 'BookHub', type: 'bookstore', icon: 'üìö',
                tagline: 'Smart shopping with automatic charity roundups',
                productName: 'Advanced Mathematics Textbook', productAuthor: 'by Dr. Smith'
            },
            'Costa Coffee': {
                name: 'Costa Coffee', type: 'cafe', icon: '‚òï',
                tagline: 'Handcrafted coffee & fresh food',
                productName: 'Cappuccino & Pastry', productAuthor: 'Freshly made'
            },
            'Tesco Express': {
                name: 'Tesco Express', type: 'grocery', icon: 'üõí',
                tagline: 'Every little helps',
                productName: 'Weekly Groceries', productAuthor: 'Fresh & quality'
            },
            'Uber': {
                name: 'Uber', type: 'transport', icon: 'üöó',
                tagline: 'Move the way you want',
                productName: 'City Centre Trip', productAuthor: '8 min journey'
            },
            'PureGym': {
                name: 'PureGym', type: 'fitness', icon: 'üí™',
                tagline: 'No contract. Pure freedom.',
                productName: 'Monthly Membership', productAuthor: '24/7 access'
            },
            'Boots Pharmacy': {
                name: 'Boots', type: 'health', icon: 'üíä',
                tagline: 'Feel good about yourself',
                productName: 'Health Supplements', productAuthor: 'Premium quality'
            }
        };

        function setMerchant(merchantName, merchantType) {
            currentMerchant = merchantName;
            currentMerchantType = merchantType;
            
            document.querySelectorAll('.merchant-btn').forEach(btn => btn.classList.remove('active'));
            event.target.closest('.merchant-btn').classList.add('active');
            
            const merchant = merchantData[merchantName];
            document.getElementById('store-name').textContent = `${merchant.icon} ${merchant.name}`;
            document.getElementById('store-tagline').textContent = merchant.tagline;
            document.getElementById('product-icon').textContent = merchant.icon;
            document.getElementById('product-name').textContent = merchant.productName;
            document.getElementById('product-author').textContent = merchant.productAuthor;
            
            console.log(`Selected merchant: ${merchantName} (${merchantType}) - AI will analyze this`);
        }

        function setAmount(amount) {
            currentAmount = amount;
            
            document.querySelectorAll('.amount-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            document.getElementById('product-price').textContent = `¬£${amount.toFixed(2)}`;
            document.getElementById('subtotal').textContent = `¬£${amount.toFixed(2)}`;
            document.getElementById('total').textContent = `¬£${amount.toFixed(2)}`;
            
            console.log(`Selected amount: ¬£${amount.toFixed(2)}`);
        }

        function setCustomAmount() {
            const customAmount = parseFloat(document.getElementById('custom-amount').value);
            if (customAmount && customAmount > 0) {
                document.querySelectorAll('.amount-btn').forEach(btn => btn.classList.remove('active'));
                setAmount(customAmount);
            }
        }

        async function processPayment() {
            const payButton = document.querySelector('.pay-button');
            const buttonText = document.querySelector('.button-text');
            const successMessage = document.getElementById('success-message');
            
            payButton.classList.add('processing');
            buttonText.textContent = 'Processing...';
            payButton.disabled = true;
            
            try {
                console.log(`Processing payment: ¬£${currentAmount} to ${currentMerchant}`);
                console.log(`AI will analyze: "${currentMerchant}" merchant type for charity selection`);
                
                // Send payment to API
                const response = await fetch('/api/payment', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        amount: currentAmount,
                        merchant: currentMerchant
                    })
                });

                if (response.ok) {
                    const result = await response.json();
                    console.log('Payment processed successfully:', result);
                    
                    // Show success
                    successMessage.style.display = 'block';
                    payButton.style.display = 'none';
                    
                    // Send message to bank app
                    const paymentMessage = {
                        type: 'PAYMENT_COMPLETED',
                        merchant: currentMerchant,
                        amount: currentAmount,
                        transaction: result.transaction
                    };
                    
                    // Broadcast to all windows
                    window.postMessage(paymentMessage, '*');
                    if (window.opener) {
                        window.opener.postMessage(paymentMessage, '*');
                    }
                    
                    // Log AI decision if available
                    if (result.transaction.charity) {
                        console.log(`üéØ AI selected: ${result.transaction.charity} (${result.transaction.ai_confidence}% confidence)`);
                        console.log(`üíù Roundup: ¬£${result.transaction.roundup.toFixed(2)} donated`);
                    }
                    
                } else {
                    const error = await response.json();
                    throw new Error(error.message || 'Payment failed');
                }
                
                // Reset after 5 seconds
                setTimeout(() => {
                    successMessage.style.display = 'none';
                    payButton.style.display = 'block';
                    payButton.classList.remove('processing');
                    buttonText.textContent = 'Pay Now';
                    payButton.disabled = false;
                }, 5000);
                
            } catch (error) {
                console.error('‚ùå Payment processing error:', error);
                
                buttonText.textContent = 'Payment Failed - Try Again';
                payButton.style.background = '#ef4444';
                
                setTimeout(() => {
                    payButton.classList.remove('processing');
                    buttonText.textContent = 'Pay Now';
                    payButton.disabled = false;
                    payButton.style.background = '';
                }, 3000);
            }
        }

        // Initialize with default merchant
        setMerchant('BookHub', 'bookstore');

        console.log('Commerce Checkout loaded - Ready for AI-powered payments!');
    </script>
</body>
</html>